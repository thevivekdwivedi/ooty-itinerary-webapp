<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Bangalore to Ooty Route</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <style>
    #map { height: 600px; width: 100%; }
  </style>
</head>
<body>
  <h4>Timeline</h4>
  <input type="range" id="timeSlider" min="0" max="7" value="0" step="1" style="width:100%">
  <div id="timeLabel" style="margin-top:5px;font-weight:bold;">Select a time to highlight a point along the route</div>
  <div id="map"></div>
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script>
    // Initialize map centered between Bangalore and Ooty
    var map = L.map('map').setView([12.2, 76.8], 6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Add a weather radar overlay using RainViewer
    // RainViewer provides radar map tiles for personal use. The API returns the
    // latest available radar map path in its JSON response【801113476249795†L50-L60】.
    // We fetch this path and build a tile layer URL. The overlay is refreshed
    // every 10 minutes so the radar stays up to date.
    var rainLayer;
    function addRainLayer() {
      fetch('https://api.rainviewer.com/public/weather-maps.json')
        .then(function(res) { return res.json(); })
        .then(function(data) {
          // Use nowcast frames if available, otherwise fall back to past frames
          var frames = [];
          if (data.radar && data.radar.nowcast && data.radar.nowcast.length) {
            frames = data.radar.nowcast;
          } else if (data.radar && data.radar.past && data.radar.past.length) {
            frames = data.radar.past;
          }
          if (!frames.length) { return; }
          var path = frames[0].path;
          var tileUrl = 'https://tilecache.rainviewer.com' + path + '/256/{z}/{x}/{y}/2/1_1.png';
          // Remove previous layer if exists
          if (rainLayer) {
            map.removeLayer(rainLayer);
          }
          rainLayer = L.tileLayer(tileUrl, {
            opacity: 0.6,
            zIndex: 2,
            attribution: 'Weather radar © RainViewer'
          });
          rainLayer.addTo(map);
        })
        .catch(function(err) {
          console.error('Error loading radar data', err);
        });
    }
    // Load initial radar overlay and schedule periodic updates (10 minutes)
    addRainLayer();
    setInterval(addRainLayer, 600000);
    // Define icons
    var defaultIcon = L.icon({
      iconUrl:'https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png',
      iconSize:[25,41], iconAnchor:[12,41], popupAnchor:[1,-34], shadowUrl:'https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png', shadowSize:[41,41]
    });
    var highlightIcon = L.icon({
      iconUrl:'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x-red.png',
      iconSize:[25,41], iconAnchor:[12,41], popupAnchor:[1,-34], shadowUrl:'https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png', shadowSize:[41,41]
    });
    // Timeline for the road trip (outbound and return)
    var timeline = [
      {time:'06:30 18 Oct', name:'Start – Bangalore', coords:[12.9716,77.5946]},
      {time:'09:00 18 Oct', name:'Mysore Palace (breakfast & tour)', coords:[12.3051,76.6551]},
      {time:'11:30 18 Oct', name:'Gundlupet break', coords:[11.8080,76.6900]},
      {time:'14:00 18 Oct', name:'Bandipur Tiger Reserve', coords:[11.6620,76.6515]},
      {time:'16:00 18 Oct', name:'Arrive – Ooty', coords:[11.4064,76.6931]},
      {time:'08:00 20 Oct', name:'Depart – Ooty', coords:[11.4064,76.6931]},
      {time:'12:00 20 Oct', name:'Lunch stop – Mysore', coords:[12.3051,76.6551]},
      {time:'17:00 20 Oct', name:'Back to Bangalore', coords:[12.9716,77.5946]}
    ];
    // Create markers
    var markers=[];
    timeline.forEach(function(item){
      var marker = L.marker(item.coords,{icon:defaultIcon}).addTo(map).bindPopup(item.name);
      markers.push(marker);
    });
    // Draw full route path (Bangalore to Ooty)
    var fullRoute = [
      [12.9716, 77.5946], // Bangalore
      [12.5237, 76.9008], // Mandya
      [12.2958, 76.6394], // Mysore
      [12.1182, 76.6846], // Nanjangud
      [11.8080, 76.6900], // Gundlupet
      [11.6620, 76.6515], // Bandipur
      [11.5771, 76.6710], // Mudumalai
      [11.4064, 76.6931]  // Ooty
    ];
    var polyline = L.polyline(fullRoute, {color:'blue', weight:4}).addTo(map);
    map.fitBounds(polyline.getBounds());
    // Slider control
    var slider=document.getElementById('timeSlider');
    var label=document.getElementById('timeLabel');
    function updateHighlight(idx){
      markers.forEach(function(m){ m.setIcon(defaultIcon); });
      markers[idx].setIcon(highlightIcon);
      label.textContent = timeline[idx].time + ' – ' + timeline[idx].name;
      map.panTo(timeline[idx].coords);
      markers[idx].openPopup();
    }
    slider.addEventListener('input', function(e){ updateHighlight(parseInt(e.target.value)); });
    updateHighlight(0);
  </script>
</body>
</html>