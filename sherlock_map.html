<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Sherlock Itinerary Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css">
  <style>#map{height:500px;width:100%;}</style>
</head>
<body>
<h4>Timeline</h4>
<input type="range" id="timeSlider" min="0" max="8" value="0" step="1" style="width:100%">
<div id="timeLabel" style="margin-top:5px;font-weight:bold;">Select a time to highlight an activity</div>
<div id="map"></div>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script>
  var map = L.map('map').setView([11.41, 76.71], 12);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution:'&copy; <a href="https://www.openstreetmap.org">OpenStreetMap</a> contributors'
  }).addTo(map);

  // Add a weather radar overlay using RainViewer
  // RainViewer provides radar map tiles for personal use. The API returns
  // the latest available radar map path in its JSON response【801113476249795†L50-L60】.
  // We fetch this path and build a tile layer URL. The overlay is refreshed
  // every 10 minutes so the radar stays up to date.
  var rainLayer;
  function addRainLayer() {
    fetch('https://api.rainviewer.com/public/weather-maps.json')
      .then(function(res) { return res.json(); })
      .then(function(data) {
        var frames = [];
        if (data.radar && data.radar.nowcast && data.radar.nowcast.length) {
          frames = data.radar.nowcast;
        } else if (data.radar && data.radar.past && data.radar.past.length) {
          frames = data.radar.past;
        }
        if (!frames.length) { return; }
        var path = frames[0].path;
        var tileUrl = 'https://tilecache.rainviewer.com' + path + '/256/{z}/{x}/{y}/2/1_1.png';
        if (rainLayer) {
          map.removeLayer(rainLayer);
        }
        rainLayer = L.tileLayer(tileUrl, {
          opacity: 0.6,
          zIndex: 2,
          attribution: 'Weather radar © RainViewer'
        });
        rainLayer.addTo(map);
      })
      .catch(function(err) {
        console.error('Error loading radar data', err);
      });
  }
  // Load initial radar overlay and schedule periodic updates (10 minutes)
  addRainLayer();
  setInterval(addRainLayer, 600000);
  // Define custom icons
  var defaultIcon = L.icon({
    iconUrl:'https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png',
    iconSize:[25,41],
    iconAnchor:[12,41],
    popupAnchor:[1,-34],
    shadowUrl:'https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png',
    shadowSize:[41,41]
  });
  var highlightIcon = L.icon({
    iconUrl:'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x-red.png',
    iconSize:[25,41],
    iconAnchor:[12,41],
    popupAnchor:[1,-34],
    shadowUrl:'https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png',
    shadowSize:[41,41]
  });
  // Timeline for Sherlock itinerary
  var timeline = [
    {time:'15:00 18 Oct', name:'Heritage walk near Sherlock', coords:[11.4066,76.7080]},
    {time:'17:00 18 Oct', name:'High tea', coords:[11.4066,76.7080]},
    {time:'18:30 18 Oct', name:'Dinner by the fireplace', coords:[11.4066,76.7080]},
    {time:'08:30 19 Oct', name:'Ooty Lake', coords:[11.4034,76.6952]},
    {time:'09:30 19 Oct', name:'St Stephen’s Church', coords:[11.4143,76.6955]},
    {time:'10:30 19 Oct', name:'Botanical Garden', coords:[11.4127,76.7031]},
    {time:'14:00 19 Oct', name:'Tea Factory', coords:[11.4107,76.7063]},
    {time:'16:00 19 Oct', name:'Doddabetta Peak', coords:[11.4333,76.7372]},
    {time:'18:00 19 Oct', name:'Reading room/garden', coords:[11.4066,76.7080]}
  ];
  var markers = [];
  timeline.forEach(function(item){
    var marker = L.marker(item.coords, {icon: defaultIcon}).addTo(map).bindPopup(item.name);
    markers.push(marker);
  });
  var route = timeline.map(function(entry){ return entry.coords; });
  var polyline = L.polyline(route, {color:'blue', weight:3}).addTo(map);
  map.fitBounds(polyline.getBounds());
  var slider = document.getElementById('timeSlider');
  var label = document.getElementById('timeLabel');
  function updateHighlight(idx){
    markers.forEach(function(m){ m.setIcon(defaultIcon); });
    markers[idx].setIcon(highlightIcon);
    label.textContent = timeline[idx].time + ' – ' + timeline[idx].name;
    map.panTo(timeline[idx].coords);
    markers[idx].openPopup();
  }
  slider.addEventListener('input', function(e){
    updateHighlight(parseInt(e.target.value));
  });
  updateHighlight(0);
</script>
</body>
</html>